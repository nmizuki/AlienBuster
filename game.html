<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <meta name="viewport" content="width=device-width initial-scale=1.0" />
  <title>宇宙人バスターズ</title>
  <link rel='stylesheet' href='css/style.css' />
</head>

<body onLoad="getItem();">
  <div id="wrapper">
    <div id="enemyStatus">
      <p>
        <img src='img/hp.png' id="hp" width='180px' height='40px'>
        <progress value="100" max="100" id="alienhpTag"></progress>
      </p>
    </div>
<!--
    	<p>
		  <select id = "penColor">
		    <option value = "black">黒</option>
			<option value = "red">赤</option>
			<option value = "blue">青</option>
			<option value = "green">緑</option>
		  </select>
		  <select id = "penWidth">
			<option value = "1">小</option>
			<option value = "3">中</option>
			<option value = "5">大</option>
		  </select>
		  <input type = "button" id= "erase" value = "消去">
		  <input type = "button" id= "save" value = "ギャラリーに追加">
		</p>
-->
	<canvas id="game">
		Canvasに対応したブラウザを用意して下さい
	</canvas>
	<div id = "gallery"></div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js">
	</script>
	<script>
		$(function(){
			var canvas = document.getElementById('game');
			if(!canvas || !canvas.getContext) return false;
			var ctx = canvas.getContext('2d');

			var startX,
				startY,
				x,
				y,
				borderWidth = 5,
				isDrawing = false;
				var canvas_info = canvas.getBoundingClientRect();
    			canvas.width = canvas_info.width;
    			canvas.height = canvas_info.height;
   				var canvas_x = canvas_info.left;
    			var canvas_y = canvas_info.top;
   				var canvas_width = canvas_info.width;
    			var canvas_height = canvas_info.height;

			$('#game').touchstart(function(e){
				isDrawing = true;
				startX = e.changedTouch[0].pageX - canvas_x;
				startY = e.changedTouch[0].pageY - canvas_y;
			})
			.touchmove(function(e){
				if(!isDrawing) return;
				x = e.changedTouch[0].pageX - $(this).offset().left - borderWidth;
				y = e.changedTouch[0].pageY - $(this).offset().top - borderWidth;
				ctx.beginPath();
				ctx.moveTo(startX,startY);
				ctx.lineTo(x,y);
				ctx.stroke();
				startX = x;
				startY = y;
			})
			.touchend(function(){
				isDrawing = false;
			})
			.touchleave(function(){
				isDrawing = false;
			});

			$('#hc').change(function(){
				ctx.strokeStyle = "red";
			});
			$('#penWidth').change(function(){
				ctx.lineWidth = $(this).val();
			});

			$('#erase').click(function(){
				if(!confirm('本当に消去しますか？'))return;
				ctx.clearRect(0,0,canvas.width,canvas.height);
			});

			$('#save').click(function(){
				var img = $('<img>').attr({
					width: 100,
					height: 50,
					src: canvas.toDataURL()
				});
				var link = $('<a>').attr({
					href:canvas.toDataURL().replace('image/png',
					'application/octet-stream'),
					download: new Date().getTime() + '.png'
				});
				$('#gallery').append(link.append(img.addClass('thumbnail')));
				ctx.clearRect(0,0,canvas.width,canvas.height);
			});

		});
	</script>
    		<input type = "hidden" id = "hc" value = "">
    <form id="buttons">
      <ul>
        <li><input type="button" value="" id="item1" class="button" onClick="selectA('item1');"></li>
        <li><input type="button" value="" id="item2" class="button" onClick="selectA('item2');"></li>
        <li><input type="button" value="" id="item3" class="button" onClick="selectA('item3');"></li>
        <li><input type="button" value="" id="item4" class="button" onClick="selectA('item4');"></li>
      </ul>
    </form>
    <div id="myStatus">
      <p>
        <img src='img/myhp.png' id="myhp" width='180px' height='40px'>
        <progress value="100" max="100" id="myhpTag"></progress>
      </p>
    </div>
  </div>
<script src='js/game.js'></script>
</body>
</html>
